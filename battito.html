<meta charset="UTF-8"><meta name="viewport" content="width=device-width"><script> onload=()=>{

document.title="Battito Beats";//https://github.com/bacionejs/battito
addEventListener("error",e=>{prompt("error",e.error.stack);});

let audio,timemodeon=0,LT=0,SC=8,SR=60,PC=48,PR=32,C3=12*7+12*3+3;
let piano      =element("div",document.body,"piano");
let message    =element("div",piano,"message");
let sliders    =element("div",document.body,"sliders");
let side       =element("div",document.body,"side");
let sequencer  =element("div",side,"sequencer");
let text       =element("textarea",side,"text");
let canvas     =element("canvas",side,"canvas");
let fullscreen =element("div",side,"fullscreen");
let loading    =element("div",side,"loading");

(function(){
initAudio();
initPiano();
initSequencer();
initSliders();
updateText();
initListeners();
initStyle();
tutorial();
compatibility();
})();










function initPiano(){
grid(piano,PC,PR);
line(piano,PC,"x",12);
line(piano,PC,"y",4);
}

function initSequencer(){
grid(sequencer,SC,SR,true);
grid(sequencer.children[0],16,1,false,"meter");
initSequencerHelpers();
}

function initSliders(){
sliders.cells=[];
SLIDERS().forEach((group,i)=>{
  group.forEach(([label,key,max])=>{
    let l=element("label",sliders);l.textContent=label;l.style.color=color(i);
    let s=element("input",sliders,"slider");
    s.type="range";s.key=key;s.max=max;s.disabled=true;
    sliders.cells.push(s);
  });
});
}










function updatePiano(){
piano.cells.forEach(cell=>{cell.style.background="";});
sequencer.cols.forEach((on,tid)=>{if(!on)return;
  let t=audio.song.tracks[tid];
  t.p[t.s[audio.currs]-1]?.forEach((note,step)=>{
    if(note && note>=C3 && note<=C3+PC){piano.cells[step*PC+note-C3].style.background=color(tid);}
  });
});
}

function updateSequencer(){
for(let i=1,cell;(cell=sequencer.cells[i]);i++){
  sequencer.toggle(cell);
  if(cell.row!=-1 && cell.col!=-1)cell.textContent=audio.song.tracks[cell.col].s[cell.row]||"";
}
}

function updateSliders(){let t=sequencer.track();sliders.cells.forEach(s=>{if(t!==null){s.disabled=false;s.value=t[s.key]||0;}else{s.disabled=true;s.value=0;}});}
function updateText(){let s=text.selectionStart;text.value=JSON.stringify(audio.song,null,2);text.setSelectionRange(s,s);}
function update(){updatePiano();updateSliders();updateSequencer();updateText();}










function initListeners(){
piano      .onclick=handlePianoClick;
sequencer  .onclick=sequencer.click;
sliders    .oninput=handleSliderInput;
text       .oninput=handleSongInput;
fullscreen .onclick=document.documentElement.requestFullscreen.bind(document.documentElement);
makeLongPress(canvas,audio.download);
makeLongPress(piano,sequencer.timemode.toggle);
[piano,sequencer,sliders].forEach(el=>{el.addEventListener('contextmenu',e=>e.preventDefault());});

function handlePianoClick({target:{row:r,col}}){
let note=col+C3,p=sequencer.pattern();if(p===null){audio.preview(note);return;}
if(timemodeon){sequencer.timemode.run(note);}
else{if(p[r]==note){p[r]=0;update();return;}p[r]=note;update();audio.preview(note);}
}

function handleSliderInput(e){
let t=sequencer.track();if(t===null)return;
t[e.target.key]=+e.target.value;
update();audio.preview();
}

function handleSongInput(){try{let song=JSON.parse(text.value);audio.song=song;updatePiano();updateSliders();updateSequencer();audio.preview();}catch(e){}}

function makeLongPress(o,callback){
let t=null,lp={
  down(e){e.preventDefault();if(t!==null){clearTimeout(t);}t=setTimeout(()=>{t=null;callback(e);},800);},
  up  (e){e.preventDefault();if(t!==null){clearTimeout(t);t=null;}}
};
o.addEventListener("pointerdown",lp.down);o.addEventListener("pointerup",lp.up);o.addEventListener("pointerleave",lp.up);
}

}//










function grid(e,cols,rows,header,classname="cell"){
let a=0;e.cells=[];if(header){a=-1;cols++;rows++;}
Object.assign(e.style,{gridTemplateColumns:"repeat("+cols+",1fr)",gridTemplateRows:"repeat("+rows+",1fr)"});
for(let i=0;i<cols*rows;i++){
  let c=i%cols,r=Math.floor(i/cols),cell=element("div",e,classname);
  if(header && !r){cell.classList.add("col-header");}
  if(header && !r && c){cell.textContent=String.fromCharCode(64+i);cell.style.color=color(i-1);}
  if(header && r && !c){cell.textContent=i/(SC+1);}
  cell.row=r+a;cell.col=c+a;
  e.cells.push(cell);
}
}

function line(e,width,dir,freq){let [rule,side]=dir=="x"?[i=>!(i%width%freq),"Left"]:[i=>!((i/width|0)%freq),"Top"];e.cells.forEach((cell,i)=>{rule(i)&&(cell.style["border"+side+"Color"]="black");});}
function element(tag,parent=document.body,c=""){let e=parent.appendChild(document.createElement(tag));if(c)e.className=c;return e;}
function color(i){let hue=((i+5)*360)/9;return "hsl("+hue+",70%,50%)";}
function compatibility(){setTimeout(()=>{let r=piano.getBoundingClientRect();if(r.width/r.height<1)return document.body.innerHTML="\u26A0 Rendering error.<br>This app requires a modern chromium-based browser.";},200);}










function initSequencerHelpers(){
let cols=Array(SC).fill(0),rows=Array(SR).fill(0); rows[-1]=cols[-1]=1; timemode();

function toggle(cell){cell.classList.toggle("active",rows[cell.row] && cols[cell.col]);}

function click({target:{row,col}}){
if(row==-1 && col==-1){     //corner
  let mr=0,mc=0; audio.song.tracks.forEach((t,c)=>t.s.forEach((v,r)=>{if(v){mr=Math.max(mr,r);mc=Math.max(mc,c);}}));
  let as=rows.slice(0,mr+1).every(Boolean) && cols.slice(0,mc+1).every(Boolean);
  rows.fill(0);cols.fill(0);if(!as){rows.fill(1,0,mr+1);cols.fill(1,0,mc+1);}
}else if(row==-1){          //column-headers
  cols[col]^=1;LT=col;audio.preview();
}else if(col==-1){          //row-headers
  rows[row]^=1;
}else{                      //grid-body
  let t=audio.song.tracks[col],np=((t.s[row]||0)+1)%10;
  t.s[row]=np;if(np>0 && !t.p[np-1]){t.p[np-1]=Array(PR).fill(0);}
}
update();audio.start();
}

function range(song){
let at=song.tracks.filter((_,c)=>cols[c]);if(!at.length)return null;
let vi=rows.map((on,r)=>(on && at.some(t=>t.s[r]))?r:-1).filter(i=>i!==-1);if(!vi.length)return null;
return {bpm:song.bpm,tracks:at.map(t=>({...t,s:vi.map(i=>t.s[i]),p:structuredClone(t.p)}))};
}

function hasnotes(song){let r=range(song);return r?.tracks.some(t=>t.s.some(p=>p>0&&t.p[p-1]?.some(Boolean)))?r:null;}

function sequences(){return rows.reduce((acc,on,r)=>{if(!on)return acc;for(let t of audio.song.tracks){if(t.s[r]){acc.push(r);break;}}return acc;},[]);}

function track(){return cols[LT] && audio.song.tracks[LT] || null;}

function pattern(){
let t=track(); if(!t||rows.filter(Boolean).length!=1)return null;
let i=rows.indexOf(1); if(!t.s[i])return null;
return t.p[t.s[i]-1]||=Array(PR).fill(0);
}

function scroll(n){sequencer.cells[(n+1)*(SC+1)].scrollIntoView({block:'center',behavior:'smooth'});}

function timemode(){
let s=0,m=["ready...","set...","GO!","wait...","reset?"];
function show(text){message.textContent=text;message.classList.remove("show");message.offsetWidth;message.classList.add("show");}
function toggle(){timemodeon^=1;if(timemodeon){run();}else{show("stepmode");s=0;}}
function next(){if(s>0&&s<5){show(m[s]);if(s===1)update();s++;if(s===5)s=0;}}
function run(note){if(s===0){show(m[0]);pattern()?.fill(0);s=1;}else if(s===3){let p=pattern();if(p){p[audio.currp]=note;update();audio.preview(note);}}}
Object.assign(timemode,{next,run,toggle});
}

Object.assign(sequencer, {toggle, timemode, cols, rows, click, track, sequences, pattern, range, hasnotes, scroll});
}//










function initAudio(){
let sequences,currS,prevS,currP,prevP,C=new AudioContext(),S=null,P=null,PLAYER=Battito(C),SONG=PRESETS();
let analyser=C.createAnalyser();analyser.fftSize=32;let A=new Uint8Array(analyser.frequencyBinCount);

function start(){
try{if(S){S.onended=null;S.stop();S.disconnect();S=null;}}catch(e){}
sequences=sequencer.sequences();if(sequences.length===0)return;
let json=sequencer.range(SONG);if(!json)return;
loading.style.display="block";requestAnimationFrame(()=>requestAnimationFrame(()=>{try{
S=Object.assign(C.createBufferSource(),{buffer:PLAYER.createbuffer(json)});S.onended=start;loading.style.display="none";
S.connect(analyser);analyser.connect(C.destination);S.start(S.startTime=C.currentTime);loop();}catch(e){}}));
}

function loop(){
if(!S?.buffer)return;
let t=(C.currentTime-S.startTime)*SONG.bpm/PR/15;if(t>=sequences.length)return;
currS=sequences[t|0];
currP=(t*PR|0)%PR;
if(currS!==prevS){point(sequencer,SC,prevS,currS,1);prevS=currS;updatePiano();sequencer.scroll(currS);}
if(currP!==prevP){point(piano    ,PC,prevP,currP  );prevP=currP;if(currP==0)sequencer.timemode.next();}
analyser.getByteFrequencyData(A);sequencer.children[0].cells.forEach((b,i)=>{b.style.height=(A[i]*0.4)+"%";});
requestAnimationFrame(loop);
}

function point(grid,width,prev,curr,o=0){[[prev,"remove"],[curr,"add"]].forEach(([x,m])=>grid.cells[(x+o)*(width+o)]?.classList[m]("row-playing"));}

function preview(note){try{
P?.stop();let threshold=0.5,t=sequencer.track();if(t===null)return;
let song={bpm:SONG.bpm,tracks:[{...t,s:[1],p:[{length:PR,0:note||t?.p[0]?.find(n=>n!==0)||147}]}]};
P=Object.assign(C.createBufferSource(),{buffer:PLAYER.createbuffer(song)});P.connect(C.destination);P.start();
let d=P.buffer.getChannelData(0),c=canvas.getContext("2d"),w=canvas.width,h=canvas.height,m=h/2;
let start=d.findIndex(v=>Math.abs(v)>=threshold),end=d.findLastIndex(v=>Math.abs(v)>=threshold);
c.clearRect(0,0,w,h);c.beginPath();for(let x=0;x<w;x++){c.lineTo(x,m+d[start+(x*(end-start)/(w-1)|0)]*m);}c.lineWidth=2;c.strokeStyle="blue";c.stroke();
}catch(e){}}

function download(){try{
if(!sequencer.hasnotes(SONG))return alert("Nothing to save. Please select song or range");
let a=element("a"),file="battito_song_"+Date.now();
a.href=URL.createObjectURL(bufferToWav());a.download=file+".wav";a.click();
a.href=URL.createObjectURL(new File([jsonToHtml()],""));a.download=file+".html";a.click();
URL.revokeObjectURL(a.href);a.remove();
}catch(e){alert(e.message);}
function jsonToHtml(){
  let s="";
  s+="\n<\script>onload=()=>{addEventListener('click',play);document.body.textContent='Click to play'";
  s+="\nlet json="+JSON.stringify(sequencer.range(SONG));
  s+="\nlet C=new AudioContext(),buffer=Battito(C).createbuffer(json)";
  s+="\nfunction play(){let S=C.createBufferSource();S.buffer=buffer;S.connect(C.destination);S.start();}//to loop: S.loop=true";
  s+="\n"+Battito;
  s+="\n}</\script>";
  return s;
}
function bufferToWav(){
  let b=S.buffer,c=b.numberOfChannels,l=b.length*c*2+44,o=new ArrayBuffer(l),v=new DataView(o),a=[],p=0,f=x=>{v.setUint16(p,x,1);p+=2;},F=x=>{v.setUint32(p,x,1);p+=4;};
  F(0x46464952);F(l-8);F(0x45564157);F(0x20746d66);F(16);f(1);f(c);F(b.sampleRate);F(b.sampleRate*c*2);f(c*2);f(16);F(0x61746164);F(l-p-4);
  for(let i=0;i<c;i++)a.push(b.getChannelData(i));
  for(let i=0,j=0;p<l;j++)for(i=0;i<c;i++){let s=a[i][j];s=s<-1?-1:s>1?1:s;s=(s<0?s*32768:s*32767)|0;v.setInt16(p,s,1);p+=2;}
  return new Blob([o],{type:"audio/wav"});
}
}

audio={start,preview,download,get song(){return SONG;},set song(newSong){SONG=newSong;},get currp(){return currP;},get currs(){return currS;}};
}//










function initStyle(){element("style").textContent=`
*{margin:0;padding:0;box-sizing:border-box;scrollbar-width:none;user-select:none;touch-action:manipulation;}
body{background:silver;display:flex;font-weight:bold;font-family:monospace;}
@keyframes fade{0%{opacity:1;}100%{opacity:0;}} .message.show{animation:fade 2s ease forwards;}
.message{color:silver;font-size:3rem;top:50%;left:50%;translate:-50% -50%;position:absolute;z-index:2;pointer-events:none;opacity:0;}
.piano, .sequencer{display:grid;} .piano{background:white;}
.sliders{display:flex;flex-direction:column;justify-content:space-evenly;font-size:8px;}
.sliders > * {display:flex;flex-direction:column;align-items:center;}
.sliders .slider{height:2px;} .sliders input[type="range"]::-webkit-slider-thumb{opacity:0;}
.sliders,.side{background:black;color:white;}
.sequencer{height:50%;aspect-ratio:1/1;overflow-y:scroll;} .sequencer > :first-child{grid-auto-flow:column;place-items:end stretch;}
.meter{pointer-events:none;background:linear-gradient(to top,lime,orange,red);transition:height 50ms linear;}
.col-header{position:sticky;top:0;background:black;z-index:1;}
.cell{display:grid;place-items:center;border:1px solid silver;aspect-ratio:1/1;}
.active{background:gray;} .row-playing{border-left:3px solid orange !important;}
.text{padding:10px;font-size:8px;white-space:pre;overflow:auto;background:transparent;color:white;outline:none;}
.text, .canvas{height:25%;aspect-ratio:2/1;border:1px solid silver;}
.fullscreen::before{content:"â›¶"} :fullscreen .fullscreen{display:none;} .loading::before{content:"loading..."}
.fullscreen, .loading{line-height:0;position:relative;bottom:1rem;z-index:1;}
.fullscreen{font-size:1rem;  text-align:right ;color:orange;right:0.5rem;}
.loading   {font-size:0.3rem;text-align:center;color:silver;display:none;}
`;
}










function SLIDERS(){return [
[["1v","osc1_vol",255],["1w","osc1_waveform",3],["1o","osc1_oct",16],["1s","osc1_det",11],["1d","osc1_detune",255]],
[["2v","osc2_vol",255],["2w","osc2_waveform",3],["2o","osc2_oct",16],["2s","osc2_det",11],["2d","osc2_detune",255]],
[["ea","env_attack",200000],["es","env_sustain",200000],["er","env_release",200000],["e1","osc1_xenv",1],["e2","osc2_xenv",1]],
[["ct","fx_filter",4],["ca","fx_freq",11025],["cr","fx_resonance",255]],
[["mw","lfo_waveform",3],["ms","lfo_freq",16],["ma","lfo_amt",255],["m1","lfo_osc1_freq",1],["mc","lfo_fx_freq",1]],
[["ds","fx_delay_time",16],["da","fx_delay_amt",248],["ps","fx_pan_freq",16],["pa","fx_pan_amt",255]],
[["nv","noise_fader",255],["vm","env_master",255]]
];}

function PRESETS(){
let v=[
[255,0,9,0,0,255,0,7,0,0,    100,0,5970,       1,1, 2,500,254,   0,0,0,0,0,    1,31,4,21,    0,171],
[255,2,6,11,0,255,2,6,11,4,  88,2000,7505,     0,0, 2,3144,51,   0,7,179,0,1,  6,60,4,64,    0,255],
[192,2,7,0,0,201,3,7,0,0,    100,150,7505,     0,0, 2,5839,254,  0,6,195,0,1,  6,121,6,147,  0,191],
[255,0,9,0,0,255,0,9,0,12,   100,0,14545,      0,0, 0,0,240,     0,0,0,0,0,    2,157,3,47,   0,70],
[255,3,7,0,0,255,0,8,0,0,    22,22,2193,       0,0, 3,4067,176,  0,3,96,0,1,   4,12,2,84,    127,255],
[255,2,7,0,0,154,2,7,0,9,    2418,1075,10614,  0,0, 3,2962,255,  0,5,124,0,1,  6,117,3,73,   0,240],
[192,3,7,0,0,201,3,7,0,7,    789,1234,13636,   0,0, 2,5839,254,  0,6,195,0,1,  6,121,6,147,  0,191],
[192,2,7,0,0,192,2,7,0,0,    0,0,20000,        0,0, 0,0,0,       0,0,0,0,0,    0,0,0,0,      0,192],
];
let sliders=SLIDERS().flat().map(s=>s[1]);
return {bpm:130,tracks:v.map(t=>{let obj={};sliders.forEach((k,i)=>obj[k]=t[i]);return Object.assign(obj,{s:[],p:[]});})};
}










function Battito(audiocontext){
let [SIN,SQUARE,SAW,TRI]=WAVES=[0,0,0,0].map(_=>new Float32Array(1024)),W=(t,v)=>(WAVES[t]||SIN)[((v*1024)&1023)>>>0];
for(let i=0;i<1024;i++)SIN[i]=Math.sin(i*2*Math.PI/1024);
for(let i=0;i<1024;i++){let p=i/1024;SQUARE[i]=p<0.5?-1:1;SAW[i]=p-0.5;let v2=p*4;TRI[i]=v2<2?v2-1:3-v2;}
let NOTE=new Float32Array(256);
for(let n=0;n<256;n++){let f=0.00390625,m=1.059463094,l=128,i=n;if(i>l)i-=l;else{i=l-i;m=1/m;}while(i-->0)f*=m;NOTE[n]=f;}
let G=(f,m,n,l)=>{if(n>l)n-=l;else{n=l-n;m=1/m;}while(n-->0)f*=m;return f;};
let R_S=1,rnd=()=>{R_S=Math.imul(R_S,0x15a4e35);return (R_S>>>0)%255/255;};
let FBASE=1.5*Math.PI/44100

let createbuffer=(json)=>{
let rowlen=Math.ceil(15*44100/json.bpm);
let SR=json.tracks.reduce((smax,t)=>t.s.length>smax?t.s.length:smax,0);
let PR=json.tracks.reduce((max,t)=>t.p.reduce((nmax,p)=>p.length>nmax?p.length:nmax,max),0);
let S=SR*PR*rowlen;
let LL=new Float32Array(S),RR=new Float32Array(S),L=new Float32Array(S),R=new Float32Array(S);
for(let i=0,T;(T=json.tracks[i]);i++){
  let {osc1_vol,osc1_waveform,osc1_oct,osc1_det,osc1_detune,osc2_vol,osc2_waveform,osc2_oct,osc2_det,osc2_detune,env_attack,env_sustain,env_release,osc1_xenv,osc2_xenv}=T;
  let {fx_filter,fx_freq,fx_resonance,lfo_waveform,lfo_freq,lfo_amt,lfo_osc1_freq,lfo_fx_freq,fx_delay_time,fx_delay_amt,fx_pan_freq,fx_pan_amt,noise_fader,env_master}=T;
  env_master*=0.006;lfo_amt/=512;fx_pan_amt/=512;osc1_vol/=255;osc2_vol/=255;noise_fader/=255;fx_resonance/=255;
  osc1_det+=(osc1_oct-8)*12;osc1_detune=1+0.2*osc1_detune/255;
  osc2_det+=(osc2_oct-8)*12;osc2_detune=1+0.2*osc2_detune/255;
  let P=0,lfostep=G(1,2,lfo_freq,8)/rowlen,panstep=G(1,2,fx_pan_freq,8)/rowlen;L.fill(0);R.fill(0);
  let envlen=env_attack+env_sustain+env_release,ai=1/env_attack,ri=1/env_release;
  for(let step=0;step<SR*PR;step++){
    let o1fb=0,o2fb=0,n=T.p?.[T.s[step/PR|0]-1]?.[step%PR];
    if(n){
      o1fb=NOTE[n+osc1_det]*osc1_detune;
      o2fb=NOTE[n+osc2_det]*osc2_detune;
      let [c1,c2,low,band]=[0,0,0,0];
      for(let j=0;j<envlen;j++){
        let b=j+P;if(b>=S)break;let lfoR,e=1,f,rs,high,t;
        lfoR=W(lfo_waveform,lfostep*b)*lfo_amt+0.5;
        if(j<env_attack)e=j*ai;else if(j>=env_attack+env_sustain)e-=(j-env_attack-env_sustain)*ri;
        let t1=o1fb;if(lfo_osc1_freq)t1+=lfoR;if(osc1_xenv)t1*=e*e;c1+=t1;rs=W(osc1_waveform,c1)*osc1_vol;
        let t2=o2fb;if(osc2_xenv)t2*=e*e;c2+=t2;rs+=W(osc2_waveform,c2)*osc2_vol;
        if(noise_fader)rs+=(rnd()*2-1)*noise_fader*e;rs*=e;
        f=fx_freq;if(lfo_fx_freq)f*=lfoR;f*=FBASE;
        if(fx_resonance){low+=f*band;high=fx_resonance*(rs-band)-low;band+=f*high;switch(fx_filter){case 1:rs=high;break;case 2:rs=low;break;case 3:rs=band;break;case 4:rs=low+high;break;}}
        t=W(0,panstep*b)*fx_pan_amt+0.5;rs*=env_master;L[b]+=rs*(1-t);R[b]+=rs*t;
      }
    }
    P+=rowlen;
  }
  let DS=Math.floor(fx_delay_time*rowlen/2);if(DS>0){let DA=fx_delay_amt/255;for(let b=0;b<S-DS;b++){L[b+DS]+=R[b]*DA;R[b+DS]+=L[b]*DA;}}
  for(let b=0;b<S;b++){LL[b]+=L[b];RR[b]+=R[b];}
}
let X=0;for(let i=0;i<S;i++){X=Math.max(X,Math.abs(LL[i]),Math.abs(RR[i]));}
if(X>0){let scale=1/X;for(let i=0;i<S;i++){LL[i]*=scale;RR[i]*=scale;}}
let b=audiocontext.createBuffer(2,LL.length,44100);[LL,RR].forEach((data,i)=>b.copyToChannel(data,i));
return b;
};

return {createbuffer};
}//










function tutorial(){
let ci=0,p,song,clicks,S,P;let m=element("div",document.body,"tut-message");m.onclick=init;setTimeout(()=>m?.remove(),3000);initStyle();

function init(){m.remove();S=sequencer;P=piano;p=element("div",document.body,"tut-pointer");p.style.transition="transform .1s ease";initSong();initClicks();move();}
function move(){if(ci>=clicks.length)return p.remove();let e=clicks[ci++]();let r=e.getBoundingClientRect();p.style.top=r.top;p.style.left=r.left;click(e);}
function click(e){setTimeout(()=>{p.style.transform="scale(.5)";e.dispatchEvent(new MouseEvent("click",{bubbles:true}));setTimeout(()=>{p.style.transform="";setTimeout(move,100);},100);},100);}
function make(clickon,c,r){return ()=>clickon.cells.find(x=>x.row===r&&x.col===c);}
function toggle(c,r){return Array(2).fill(0).flatMap(()=>[make(S,c,-1),make(S,-1,r)]);}

function initClicks(){let notes=new Map();
let sequencerclicks=song.flatMap((t,c)=>t[0].flatMap((pid,r)=>(notes.set(c+"-"+pid,{c,r,a:t[1][pid-1]}),Array(pid).fill(0).map(()=>make(S,c,r)))));
let pianoclicks=[...notes.values()].flatMap(({c,r,a})=>toggle(c,r).toSpliced(2,0,...a.flatMap((n,r)=>n?[make(P,n-123,r)]:[])));
clicks=[...sequencerclicks,...pianoclicks,make(S,-1,-1)];
}

function initSong(){song=[
[[1,1,1,1],[[123,,,,123,,,,123,,,,123,,,,123,,,,123,,,,123,,,,123]]],
[[1,1,1,1],[[,,124,,,,,,,,,,,,124,,124]]],
[[1,1,2,3],[[135,,,,,,,,159,,157,,159,,,,,,,,,,,,147,154,,159],[138,,,,,,,,150,,159,,162,,,,,,,,,,150,,162,150,,159],[149,,,,,,,,149,,150,,154,,,,,,,,,,,,147,157,,159]]]];
}

function initStyle(){
element("style").textContent=""
+".tut-pointer,.tut-message{position:fixed;z-index:2;}"
+".tut-pointer::before{content:'ðŸ‘‰';}"
+".tut-message::before{content:'Click here to watch a 25 second tutorial';}"
+".tut-message{background:orange;color:black;padding:10;border-radius:5px;top:6dvh;border:2px outset orange;text-align:center;left:50%;transform:translateX(-50%);}"
;
}

}//

}</script>
